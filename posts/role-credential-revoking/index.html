<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>role_credential_revoking | JellyParks</title><meta name=keywords content="aws,cloud,dfir"><meta name=description content="IAM roles can have all current credentials revoked. This can be great to stop an attacker, but at what cost?"><meta name=author content="Travis"><link rel=canonical href=https://jellyparks.com/posts/role-credential-revoking/><link crossorigin=anonymous href=/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://jellyparks.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-13VPCR43BS"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-13VPCR43BS",{anonymize_ip:!1})}</script><meta property="og:title" content="role_credential_revoking"><meta property="og:description" content="IAM roles can have all current credentials revoked. This can be great to stop an attacker, but at what cost?"><meta property="og:type" content="article"><meta property="og:url" content="https://jellyparks.com/posts/role-credential-revoking/"><meta property="og:image" content="https://jellyparks.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-28T00:00:00+00:00"><meta property="article:modified_time" content="2018-11-28T00:00:00+00:00"><meta property="og:site_name" content="JellyParks"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jellyparks.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="role_credential_revoking"><meta name=twitter:description content="IAM roles can have all current credentials revoked. This can be great to stop an attacker, but at what cost?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://jellyparks.com/posts/"},{"@type":"ListItem","position":3,"name":"role_credential_revoking","item":"https://jellyparks.com/posts/role-credential-revoking/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"role_credential_revoking","name":"role_credential_revoking","description":"IAM roles can have all current credentials revoked. This can be great to stop an attacker, but at what cost?","keywords":["aws","cloud","dfir"],"articleBody":" The conversation came up about revoking credentials for a role associated which had ec2 instances associated with it. Does it impact the instance at all? When will the instance refresh its access keys? Is there just a blip in the EC2’s access to AWS API calls or is it unable to make calls until its keys TTL ends? These were all questions that we did not know the answer to. The official Amazon docs here and here don’t necessarily cover the fall out or recovery from this action.\nYou may ask yourself, if an EC2 instance with a role associated with it was compromised why would you want to revoke credentials from it and then turn around and provide the instance with a new set of keys and the same level of access it previously had? This is a valid point, but sometimes the business needs a service running. Perhaps it is making lots of money, or perhaps it is high visibility to the businesses brand. Sometimes the only choice which makes sense is to try and mitigate the issue without impacting production.\nThe Setup For the experiement below I have an EC2 instance with a role that permits it to access S3. The process flow is:\nQuery S3 validate everything is working Revoke active sessions for the role, we should see the S3 queries begin to fail Remove the instance profile from the instance, our access key should change, and S3 queries should continue to fail Reapply the instance profile granting s3 access, our acess key should change once again, and the S3 queries should be successful Test 1 I built a python script to query the meta data service, determine the pertinent information about the access key currently associated with the instance, leverage boto3 to make a call to s3 and list the buckets. The script counts the number of buckets and prints all of the information to the screen if successful. If the script fails it shows the key and a failure message. The first script is below:\nimport requests import boto3 import time import sys def main(): try: while True: s3_client = boto3.client('s3') response = requests.get('http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance/') response = response.json() expiration = response['Expiration'] last_update = response['LastUpdated'] token = response['Token'] accesskey = response['AccessKeyId'] try: s3_response = s3_client.list_buckets() number_of_buckets = len(s3_response['Buckets']) response_code = s3_response['ResponseMetadata']['HTTPStatusCode'] print(f'AccessKeyId: {accesskey} -- Expiration: {expiration} -- LastUpdated: {last_update} -- ResponseCode: {response_code} -- NumberofBuckets: {number_of_buckets}') except: print(f'Keys no longer valid -- AccessKeyId: {accesskey} -- Expiration: {expiration} -- LastUpdated: {last_update}') pass time.sleep(1) except KeyboardInterrupt: print('\\n Bye') sys.exit() if __name__ == \"__main__\": main() I started the script above, and everything seemed to be working as expected. What is interesting about this script is that didn’t have the initial outcome I expected. Despite the meta-data service showing a refresh to the keys, it apepared that boto3 did not. It acted as if everything was a single session. In my initial coding of the script I assumed that since I was creating a new client with each call this would not have been a problem. To work around the problem I reworked the script.\nTest 2 For test 2 I modifed the code to manually define the credentials for the s3 client (lines 16-21) by using the values from the meta data response.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 import requests import boto3 import time import sys def main(): try: while True: response = requests.get('http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance/') response = response.json() expiration = response['Expiration'] last_update = response['LastUpdated'] token = response['Token'] secret = response['SecretAccessKey'] accesskey = response['AccessKeyId'] s3_client = boto3.client( 's3', aws_access_key_id=accesskey, aws_secret_access_key=secret, aws_session_token=token) ) try: s3_response = s3_client.list_buckets() number_of_buckets = len(s3_response['Buckets']) response_code = s3_response['ResponseMetadata']['HTTPStatusCode'] print(f'AccessKeyId: {accesskey} -- Expiration: {expiration} -- LastUpdated: {last_update} -- ResponseCode: {response_code} -- NumberofBuckets: {number_of_buckets}') except: print(f'Keys no longer valid -- AccessKeyId: {accesskey} -- Expiration: {expiration} -- LastUpdated: {last_update}') pass time.sleep(1) except KeyboardInterrupt: print('\\n Bye') sys.exit() if __name__ == \"__main__\": main() Once again, this failed. Unexpectidly it still appeared that the boto client was retaining the original credentials. After doing some digging it appears that this is true, even though I am setting the credentials with each iteration, boto3 apparently still caches the session. The only way to work around this is to create a new session with botocore.\nTest 3 I rewrote the script to leverage botocore.session and ended up with the code below:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 import requests import boto3 import time import sys def main(): try: while True: response = requests.get('http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance/') response = response.json() expiration = response['Expiration'] last_update = response['LastUpdated'] token = response['Token'] secret = response['SecretAccessKey'] accesskey = response['AccessKeyId'] s3_session = '' s3_session = botocore.session.get_session() s3_client = s3_session.create_client('s3', region_name='us-east-1') try: s3_response = s3_client.list_buckets() number_of_buckets = len(s3_response['Buckets']) response_code = s3_response['ResponseMetadata']['HTTPStatusCode'] print(f'AccessKeyId: {accesskey} -- Expiration: {expiration} -- LastUpdated: {last_update} -- ResponseCode: {response_code} -- NumberofBuckets: {number_of_buckets}') except: print(f'Keys no longer valid -- AccessKeyId: {accesskey} -- Expiration: {expiration} -- LastUpdated: {last_update}') pass time.sleep(1) except KeyboardInterrupt: print('\\n Bye') sys.exit() if __name__ == \"__main__\": main() Now when I ran the script, each new loop was ACTUALLY get new credentials and not leveraging cached ones. The process worke just as it should and I recieved the outputs below as I progressed through each stage.\nAccessKeyId: ASIA4NX323S76LIV -- Expiration: 2020-07-04T20:23:29Z -- LastUpdated: 2020-07-04T14:13:19Z -- ResponseCode: 200 -- NumberofBuckets: 9 Revoke the role credentials in IAM.\nKeys no longer valid -- AccessKeyId: ASIA4NX323S76LIV -- Expiration: 2020-07-04T20:23:29Z -- LastUpdated: 2020-07-04T14:13:19Z -- Exception: An error occurred (AccessDenied) when calling the ListBuckets operation: Access Denied Remove the role to generate a new set of credentials instead of waiting for the old credentials to expire sometime within the next 12 hours.\nKeys no longer valid -- AccessKeyId: ASIA4NX325UZ6YFR -- Expiration: 2020-07-04T20:25:21Z -- LastUpdated: 2020-07-04T14:16:02Z -- Exception: Unable to locate credentials Re-apply the role to the ec2 instance and generate yet another set of credentials.\nAccessKeyId: ASIA4NX3WW2QDQ5K -- Expiration: 2020-07-04T20:42:54Z -- LastUpdated: 2020-07-04T14:17:33Z -- ResponseCode: 200 -- NumberofBuckets: 9 Key Takeaways The behavior of the scripts was very interesting and should not be taken lightly. I would assume there is a high chance that any scripts running on an EC2 instance would be written in a way similar to the script in the first test. If as an IR team we revoked the credentials for the role (due to compromise), removed the instance profile, and then reapplied the profile in an effort to maintain ‘uptime’ for the business process it may still cause an outage because the client has cached credentials.\nRebooting the instance may fix this issue, but at that point you’ve still rebooted the instance potentially causing an outage. Obviously the best case scenario is to fully remediate before having the instance available again, but sometimes the businesses needs outweigh the risk.\n","wordCount":"1163","inLanguage":"en","datePublished":"2018-11-28T00:00:00Z","dateModified":"2018-11-28T00:00:00Z","author":{"@type":"Person","name":"Travis"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jellyparks.com/posts/role-credential-revoking/"},"publisher":{"@type":"Organization","name":"JellyParks","logo":{"@type":"ImageObject","url":"https://jellyparks.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jellyparks.com accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://jellyparks.com/posts title=all_posts><span>all_posts</span></a></li><li><a href=https://jellyparks.com/categories/ title=categories><span>categories</span></a></li><li><a href=https://jellyparks.com/tags/ title=tags><span>tags</span></a></li><li><a href=https://jellyparks.com/me/ title=me><span>me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://jellyparks.com>Home</a>&nbsp;»&nbsp;<a href=https://jellyparks.com/posts/>Posts</a></div><h1 class=post-title>role_credential_revoking</h1><div class=post-meta><span title='2018-11-28 00:00:00 +0000 UTC'>November 28, 2018</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Travis&nbsp;|&nbsp;<a href=https://github.com/yogisec/yogisec.github.io/blob/main/content/posts/role-credential-revoking/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#the-setup aria-label="The Setup">The Setup</a></li><li><a href=#test-1 aria-label="Test 1">Test 1</a></li><li><a href=#test-2 aria-label="Test 2">Test 2</a></li><li><a href=#test-3 aria-label="Test 3">Test 3</a></li><li><a href=#key-takeaways aria-label="Key Takeaways">Key Takeaways</a></li></ul></div></details></div><div class=post-content><hr><p>The conversation came up about revoking credentials for a role associated which had ec2 instances associated with it. Does it impact the instance at all? When will the instance refresh its access keys? Is there just a blip in the EC2&rsquo;s access to AWS API calls or is it unable to make calls until its keys TTL ends? These were all questions that we did not know the answer to. The official Amazon docs here and here don&rsquo;t necessarily cover the fall out or recovery from this action.</p><p>You may ask yourself, if an EC2 instance with a role associated with it was compromised why would you want to revoke credentials from it and then turn around and provide the instance with a new set of keys and the same level of access it previously had? This is a valid point, but sometimes the business needs a service running. Perhaps it is making lots of money, or perhaps it is high visibility to the businesses brand. Sometimes the only choice which makes sense is to try and mitigate the issue without impacting production.</p><hr><h3 id=the-setup>The Setup<a hidden class=anchor aria-hidden=true href=#the-setup>#</a></h3><p>For the experiement below I have an EC2 instance with a role that permits it to access S3. The process flow is:</p><ol><li>Query S3 validate everything is working</li><li>Revoke active sessions for the role, we should see the S3 queries begin to fail</li><li>Remove the instance profile from the instance, our access key should change, and S3 queries should continue to fail</li><li>Reapply the instance profile granting s3 access, our acess key should change once again, and the S3 queries should be successful</li></ol><hr><h3 id=test-1>Test 1<a hidden class=anchor aria-hidden=true href=#test-1>#</a></h3><p>I built a python script to query the meta data service, determine the pertinent information about the access key currently associated with the instance, leverage boto3 to make a call to s3 and list the buckets. The script counts the number of buckets and prints all of the information to the screen if successful. If the script fails it shows the key and a failure message. The first script is below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>s3_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;s3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>response</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=n>expiration</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;Expiration&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>last_update</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;LastUpdated&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>token</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;Token&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>accesskey</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;AccessKeyId&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s3_response</span> <span class=o>=</span> <span class=n>s3_client</span><span class=o>.</span><span class=n>list_buckets</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>number_of_buckets</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>s3_response</span><span class=p>[</span><span class=s1>&#39;Buckets&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>response_code</span> <span class=o>=</span> <span class=n>s3_response</span><span class=p>[</span><span class=s1>&#39;ResponseMetadata&#39;</span><span class=p>][</span><span class=s1>&#39;HTTPStatusCode&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;AccessKeyId: </span><span class=si>{</span><span class=n>accesskey</span><span class=si>}</span><span class=s1> -- Expiration: </span><span class=si>{</span><span class=n>expiration</span><span class=si>}</span><span class=s1> -- LastUpdated: </span><span class=si>{</span><span class=n>last_update</span><span class=si>}</span><span class=s1> -- ResponseCode: </span><span class=si>{</span><span class=n>response_code</span><span class=si>}</span><span class=s1> -- NumberofBuckets: </span><span class=si>{</span><span class=n>number_of_buckets</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Keys no longer valid -- AccessKeyId: </span><span class=si>{</span><span class=n>accesskey</span><span class=si>}</span><span class=s1> -- Expiration: </span><span class=si>{</span><span class=n>expiration</span><span class=si>}</span><span class=s1> -- LastUpdated: </span><span class=si>{</span><span class=n>last_update</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>      <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1> Bye&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><p>I started the script above, and everything seemed to be working as expected. What is interesting about this script is that didn&rsquo;t have the initial outcome I expected. Despite the meta-data service showing a refresh to the keys, it apepared that boto3 did not. It acted as if everything was a single session. In my initial coding of the script I assumed that since I was creating a new client with each call this would not have been a problem. To work around the problem I reworked the script.</p><hr><h3 id=test-2>Test 2<a hidden class=anchor aria-hidden=true href=#test-2>#</a></h3><p>For test 2 I modifed the code to manually define the credentials for the s3 client (lines 16-21) by using the values from the meta data response.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=hl><span class=lnt>16
</span></span><span class=hl><span class=lnt>17
</span></span><span class=hl><span class=lnt>18
</span></span><span class=hl><span class=lnt>19
</span></span><span class=hl><span class=lnt>20
</span></span><span class=hl><span class=lnt>21
</span></span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>response</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=n>expiration</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;Expiration&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>last_update</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;LastUpdated&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>token</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;Token&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>secret</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;SecretAccessKey&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>accesskey</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;AccessKeyId&#39;</span><span class=p>]</span>
</span></span><span class="line hl"><span class=cl>      <span class=n>s3_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span>
</span></span><span class="line hl"><span class=cl>       <span class=s1>&#39;s3&#39;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>       <span class=n>aws_access_key_id</span><span class=o>=</span><span class=n>accesskey</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>       <span class=n>aws_secret_access_key</span><span class=o>=</span><span class=n>secret</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>       <span class=n>aws_session_token</span><span class=o>=</span><span class=n>token</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl>       <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s3_response</span> <span class=o>=</span> <span class=n>s3_client</span><span class=o>.</span><span class=n>list_buckets</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>number_of_buckets</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>s3_response</span><span class=p>[</span><span class=s1>&#39;Buckets&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>response_code</span> <span class=o>=</span> <span class=n>s3_response</span><span class=p>[</span><span class=s1>&#39;ResponseMetadata&#39;</span><span class=p>][</span><span class=s1>&#39;HTTPStatusCode&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;AccessKeyId: </span><span class=si>{</span><span class=n>accesskey</span><span class=si>}</span><span class=s1> -- Expiration: </span><span class=si>{</span><span class=n>expiration</span><span class=si>}</span><span class=s1> -- LastUpdated: </span><span class=si>{</span><span class=n>last_update</span><span class=si>}</span><span class=s1> -- ResponseCode: </span><span class=si>{</span><span class=n>response_code</span><span class=si>}</span><span class=s1> -- NumberofBuckets: </span><span class=si>{</span><span class=n>number_of_buckets</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Keys no longer valid -- AccessKeyId: </span><span class=si>{</span><span class=n>accesskey</span><span class=si>}</span><span class=s1> -- Expiration: </span><span class=si>{</span><span class=n>expiration</span><span class=si>}</span><span class=s1> -- LastUpdated: </span><span class=si>{</span><span class=n>last_update</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>      <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1> Bye&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>main</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>Once again, this failed. Unexpectidly it still appeared that the boto client was retaining the original credentials. After doing some digging it appears that this is true, even though I am setting the credentials with each iteration, boto3 apparently still caches the session. The only way to work around this is to create a new session with botocore.</p><hr><h3 id=test-3>Test 3<a hidden class=anchor aria-hidden=true href=#test-3>#</a></h3><p>I rewrote the script to leverage botocore.session and ended up with the code below:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=hl><span class=lnt>16
</span></span><span class=hl><span class=lnt>17
</span></span><span class=hl><span class=lnt>18
</span></span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>response</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=n>expiration</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;Expiration&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>last_update</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;LastUpdated&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>token</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;Token&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>secret</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;SecretAccessKey&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>accesskey</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;AccessKeyId&#39;</span><span class=p>]</span>
</span></span><span class="line hl"><span class=cl>      <span class=n>s3_session</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class="line hl"><span class=cl>      <span class=n>s3_session</span> <span class=o>=</span> <span class=n>botocore</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>get_session</span><span class=p>()</span>
</span></span><span class="line hl"><span class=cl>      <span class=n>s3_client</span> <span class=o>=</span> <span class=n>s3_session</span><span class=o>.</span><span class=n>create_client</span><span class=p>(</span><span class=s1>&#39;s3&#39;</span><span class=p>,</span> <span class=n>region_name</span><span class=o>=</span><span class=s1>&#39;us-east-1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s3_response</span> <span class=o>=</span> <span class=n>s3_client</span><span class=o>.</span><span class=n>list_buckets</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>number_of_buckets</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>s3_response</span><span class=p>[</span><span class=s1>&#39;Buckets&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>response_code</span> <span class=o>=</span> <span class=n>s3_response</span><span class=p>[</span><span class=s1>&#39;ResponseMetadata&#39;</span><span class=p>][</span><span class=s1>&#39;HTTPStatusCode&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;AccessKeyId: </span><span class=si>{</span><span class=n>accesskey</span><span class=si>}</span><span class=s1> -- Expiration: </span><span class=si>{</span><span class=n>expiration</span><span class=si>}</span><span class=s1> -- LastUpdated: </span><span class=si>{</span><span class=n>last_update</span><span class=si>}</span><span class=s1> -- ResponseCode: </span><span class=si>{</span><span class=n>response_code</span><span class=si>}</span><span class=s1> -- NumberofBuckets: </span><span class=si>{</span><span class=n>number_of_buckets</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Keys no longer valid -- AccessKeyId: </span><span class=si>{</span><span class=n>accesskey</span><span class=si>}</span><span class=s1> -- Expiration: </span><span class=si>{</span><span class=n>expiration</span><span class=si>}</span><span class=s1> -- LastUpdated: </span><span class=si>{</span><span class=n>last_update</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>      <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1> Bye&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>main</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>Now when I ran the script, each new loop was ACTUALLY get new credentials and not leveraging cached ones. The process worke just as it should and I recieved the outputs below as I progressed through each stage.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>AccessKeyId: ASIA4NX323S76LIV -- Expiration: 2020-07-04T20:23:29Z -- LastUpdated: 2020-07-04T14:13:19Z -- ResponseCode: <span class=m>200</span> -- NumberofBuckets: <span class=m>9</span>
</span></span></code></pre></div><p>Revoke the role credentials in IAM.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Keys no longer valid -- AccessKeyId: ASIA4NX323S76LIV -- Expiration: 2020-07-04T20:23:29Z -- LastUpdated: 2020-07-04T14:13:19Z -- Exception: An error occurred <span class=o>(</span>AccessDenied<span class=o>)</span> when calling the ListBuckets operation: Access Denied
</span></span></code></pre></div><p>Remove the role to generate a new set of credentials instead of waiting for the old credentials to expire sometime within the next 12 hours.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Keys no longer valid -- AccessKeyId: ASIA4NX325UZ6YFR -- Expiration: 2020-07-04T20:25:21Z -- LastUpdated: 2020-07-04T14:16:02Z -- Exception: Unable to locate credentials
</span></span></code></pre></div><p>Re-apply the role to the ec2 instance and generate yet another set of credentials.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>AccessKeyId: ASIA4NX3WW2QDQ5K -- Expiration: 2020-07-04T20:42:54Z -- LastUpdated: 2020-07-04T14:17:33Z -- ResponseCode: <span class=m>200</span> -- NumberofBuckets: <span class=m>9</span>
</span></span></code></pre></div><hr><h3 id=key-takeaways>Key Takeaways<a hidden class=anchor aria-hidden=true href=#key-takeaways>#</a></h3><p>The behavior of the scripts was very interesting and should not be taken lightly. I would assume there is a high chance that any scripts running on an EC2 instance would be written in a way similar to the script in the first test. If as an IR team we revoked the credentials for the role (due to compromise), removed the instance profile, and then reapplied the profile in an effort to maintain &lsquo;uptime&rsquo; for the business process it may still cause an outage because the client has cached credentials.</p><p>Rebooting the instance may fix this issue, but at that point you&rsquo;ve still rebooted the instance potentially causing an outage. Obviously the best case scenario is to fully remediate before having the instance available again, but sometimes the businesses needs outweigh the risk.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://jellyparks.com/tags/aws/>aws</a></li><li><a href=https://jellyparks.com/tags/cloud/>cloud</a></li><li><a href=https://jellyparks.com/tags/dfir/>dfir</a></li></ul><nav class=paginav><a class=prev href=https://jellyparks.com/posts/me/><span class=title>« Prev Page</span><br><span>me</span></a>
<a class=next href=https://jellyparks.com/posts/saml-overview/><span class=title>Next Page »</span><br><span>saml_overview</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share role_credential_revoking on twitter" href="https://twitter.com/intent/tweet/?text=role_credential_revoking&url=https%3a%2f%2fjellyparks.com%2fposts%2frole-credential-revoking%2f&hashtags=aws%2ccloud%2cdfir"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share role_credential_revoking on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fjellyparks.com%2fposts%2frole-credential-revoking%2f&title=role_credential_revoking&summary=role_credential_revoking&source=https%3a%2f%2fjellyparks.com%2fposts%2frole-credential-revoking%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share role_credential_revoking on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fjellyparks.com%2fposts%2frole-credential-revoking%2f&title=role_credential_revoking"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share role_credential_revoking on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjellyparks.com%2fposts%2frole-credential-revoking%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share role_credential_revoking on whatsapp" href="https://api.whatsapp.com/send?text=role_credential_revoking%20-%20https%3a%2f%2fjellyparks.com%2fposts%2frole-credential-revoking%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share role_credential_revoking on telegram" href="https://telegram.me/share/url?text=role_credential_revoking&url=https%3a%2f%2fjellyparks.com%2fposts%2frole-credential-revoking%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://jellyparks.com>JellyParks</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>