<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>iam_privesc_by_attachment | JellyParks</title><meta name=keywords content="aws,cloud,cloudgoat,walkthrough,ctf"><meta name=description content="Cloud Goat IAM priviledge escalation by attachment scenario walkthrough"><meta name=author content="Travis"><link rel=canonical href=https://jellyparks.com/posts/iam-privesc-by-attachment/><link crossorigin=anonymous href=/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://jellyparks.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://jellyparks.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-133811886-2","auto"),ga("send","pageview"))</script><meta property="og:title" content="iam_privesc_by_attachment"><meta property="og:description" content="Cloud Goat IAM priviledge escalation by attachment scenario walkthrough"><meta property="og:type" content="article"><meta property="og:url" content="https://jellyparks.com/posts/iam-privesc-by-attachment/"><meta property="og:image" content="https://jellyparks.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-28T00:00:00+00:00"><meta property="article:modified_time" content="2018-11-28T00:00:00+00:00"><meta property="og:site_name" content="JellyParks"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jellyparks.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="iam_privesc_by_attachment"><meta name=twitter:description content="Cloud Goat IAM priviledge escalation by attachment scenario walkthrough"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://jellyparks.com/posts/"},{"@type":"ListItem","position":3,"name":"iam_privesc_by_attachment","item":"https://jellyparks.com/posts/iam-privesc-by-attachment/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"iam_privesc_by_attachment","name":"iam_privesc_by_attachment","description":"Cloud Goat IAM priviledge escalation by attachment scenario walkthrough","keywords":["aws","cloud","cloudgoat","walkthrough","ctf"],"articleBody":" Once the scenario is creation process completes we are presented with a set of access keys for a user account ‘kerrigan’\n whoami First lets make sure the credentials that we have obtained are valid:\naws sts get-caller-identity --profile xxx |jq Perfect, looks like the credentials work. Now, what can they do?\n What can I do? Lets use pacu to brute force some permissions. We can do this by running:\nrun iam__bruteforce_permissions Once the command completes we see the output below:\nOverall the credentials are fairly limited. But it does look like we have the ability to learn about ec2 instances with the describe command. Lets bounce back to the aws cli and run:\naws ec2 describe-instances |jq We get an output thatshows us details about the instances within the us-east region of this account. Lets clean this up a little bit just for fun.\naws --profile kerrigan ec2 describe-instances |jq -r '.Reservations[0].Instances[].InstanceId,.Reservations[0].Instances[].SecurityGroups[].GroupName,.Reservations[0].Instances[].NetworkInterfaces[].Association[]' *Note in the command above I set the Reservations to the value in the first index. To see all instances leave the brackets empty ‘[]’\nThis cleans up the verbose output and prints the instance id, security groups, and some networking details about the instance\nLets see what else our permissions can do. We’ll start with the instance profiles command. According to Pacu we have rights to invoke this command.\naws iam list-instance-profiles |jq Looking at the output below we see a profile with the ‘cg-ec2-meek-role’ associated with it.\nLets use pacu to see what instances,security groups, vpcs, and subnets exist within the environment:\nrun ec2__enum --region=us-east-1 Looking at the output we can see that there are currently 4 instances in the region as well as additional information that may become useful.\nWithin Pacu running the data command will dump all of the data from the current session. This will include all of the details we just enumerated about the EC2’s within the account.\nLets head back to the aws cli and run the ec2 describe call again. This time instead of jq we will just print the output to a table.\naws --profile kerrigan ec2 describe-instances --output table Looking at the output we can see that there is an ec2 and one of the tags is that it is a super critical server.\n More Enumeration Considering everything that we’ve seen up to this point:\n A critical instance exists We can perform several ec2 tasks We do have some limited iam rights  There seems to be some potential for us to create an instance. Lets use Pacu to see if we have any additional iam permissions that could be of use.\nrun iam__enum_users_roles_policies_groups In the output below it looks like we do not have permissions to make the: list_users, list_groups, or list_policies calls. We do however have permissions to list roles within the account.\nLets dig into those a big more. This can be done by either running the data command from within Pacu or by running the following command via the aws cli:\naws --profile kerrigan iam list-roles | jq '.Roles[].RoleName' Considering the role we saw associated with the ec2 instance earlier was called meek it’s interesting to see another role with the name of mightly. Lets dig into that a bit more. Instead of making another iam list-roles call to AWS, lets just use the existing data within Pacu by running the data command.\nIn the picture above we can see that the mighty role is a role associated with the ec2 service. This is a role that can be associated with an ec2 profile, and the profile can be associated with an ec2 instance.\nConsidering we have permissions into describing instalnce profile associates, perhaps we also have the ability to associate different roles to a profile. Lets see if we can attach the mighty role to the ec2 profile\nOnly one role can be associated with an ec2 instance profile at a time. To begin we will see if we can remove the existing meek role from the profile. We need to pieces of information in order to remove a role from an instance profile. The role name we want to remove, and the profile we want to remove it from. Luckily we know both of those bits of information from our enumeration.\n Role: cg-ec2-meek-role-cgidawtm15fqxm Profile: cg-ec2-meek-instance-profile-cgidawtm15fqxm  aws --profile kerrigan iam remove-role-from-instance-profile --instance-profile-name=cg-ec2-meek-instance-profile-cgidawtm15fqxm --role-name=cg-ec2-meek-role-cgidawtm15fqxm If the command is successful, there will be no output, if it fails, it squawks. We can confirm it as successful by running the list-instance-profiles command again.\nIn the output above we see the meek instance profile with no roles associated with it. Great! Now lets try associating the mighty role with the meek instance profile. In order to do this we need two pieces of information, the role name, and the instance profile name.\n Role: cg-ec2-mighty-role-cgidawtm15fqxm Profile: cg-ec2-meek-instance-profile-cgidawtm15fqxm  aws --profile kerrigan iam add-role-to-instance-profile --instance-profile-name=cg-ec2-meek-instance-profile-cgidawtm15fqxm --role-name=cg-ec2-mighty-role-cgidawtm15fqxm Similar to the output when we removed the role from the profile, there will be no output if successful. However running the list-instance-profiles command again we can see that the mighty role has been associated with the meek instance profile.\nPerfect! We now have the mighty role associated with the meek profile.\n Make an ec2 Lets create our own ec2 and see if we can associate the meek instance profile with the now might role attached to an ec2 instance that we can gain access to. In order to create an ec2 we need several pieces of information:\n ssh key security group ids subnet id image-id instance-type  First we need a key pair the command below will create the ssh key named totes-legit, parses it with jq to just show the key details, and then sends the output into a file called totes-legit:\naws --profile kerrigan ec2 create-key-pair --key-name totes-legit |jq -r '.KeyMaterial'  ~/.ssh/totes-legit Next we need to find a security group that fits our needs, or see if we can build our own. After all what use is an instane if we cannot connect to it. We can use data from Pacu or we can make another call to aws\naws --profile kerrigan ec2 describe-security-groups Looking at the output we can see that there is already a group that fits our needs, it allows SSH from an IP address that we have access to.\nWe know that the super critical server has a public IP address, we also have the subnet for that instance. We can use that subnet-id when we create our new instance.\nAt this point We have all of the pieces that we need to create an instance that we will have access to (hopefully).\n ssh key: totes-legit security group ids: sg-0594794cf09e47456 subnet id: subnet-0157cfe78e8beca7a image-id: ami-0a313d6098716f372 instance-type: t2.micro Time to create an instance:  aws --profile kerrigan ec2 run-instances --image-id=ami-0a313d6098716f372 --count=1 --instance-type=t2.micro --security-group-ids=subnet-01a29bf90aca8c8d9 --subnet-id=subnet-0157cfe78e8beca7a --key-name=totes-legit --tags Key=Name,Value=totes-legit When this is successful all of the data bout our instance is returned. This includes our instance id, ip information, and current state. and returns our instance id.\n\"InstanceId\": \"i-06f3f5f9f8cdc9c6e\" Unfortunatly, we don’t seem to have a public IP address for our instance. Did something go wrong? Nope, the current stat of the instance was ‘pending’. We need to check back in on the instance an wait for the state to change to ‘running’. Once its running, we should also have public IP address information. We can do this with the describe-instances command.\naws --profile kerrigan ec2 describe-instances --instance-id=i-06f3f5f9f8cdc9c6e The output from the command in the picture above shows that the instance is ‘running’ and that we have a public IP.\n\"PublicIpAddress\": \"18.232.65.212\" Now we can ssh into the box using our totes-legit key:\nssh -i ~/.ssh/totes-legit ubuntu@18.232.65.212 Now we can query the meta data service and extract the instance keys, or we could run commands directly through this ec2. Lets grab the keys.\ncurl http://169.254.169.254/latest/meta-data/iam/ Weird, looking at the output below we get a 404 error and no access keys. What could cause that?\n More Power Looking back at what we’ve done.\n We found an instance profile We disassociated a role with the instance profile We associated a new role with the instance profile We created an ec2 instance that we have access to.  Something we have not done yet, associate an instance profile with our instance. This profile is how our instance gains privileges. Remeber, an ec2 can have an instance profile associated with it. That profile can have 1 role associated with it, and that role can have policies attached to it.\nLets assign a profile to our instance. We’ll need our instance Id, and the meek-instance profile name we discovered earlier.\naws --profile kerrigan ec2 associate-iam-instance-profile --instance-id=i-06f3f5f9f8cdc9c6e --iam-instance-profile Name=cg-ec2-meek-instance-profile-cgidawtm15fqxm Once the command is executed we’ll see an output similar to the one below with a state of associating\nAfter a minute or two we can check back in on our instsance and attempt to curl for credentials again:\ncurl http://169.254.169.254/latest/meta-data/iam/ The output has changed, from a 404 error to the one below.\nDigging deeper into the meta data we can find an AccessKey, SecretAcessKey, and a Token needed to access the aws api\ncurl http://169.254.169.254/latest/meta-data/iam/security-credentials/cg-ec2-mighty-role-cgidawtm15fqxm We have a few options at this point:\n Take the access key information and run aws cli commands from our workstation Install/use the aws cli on the instance we control to run commands Use the pacu proxy  Each of these has there own benefits and draw backs. If we steal the keys and use them locally, we run the risk of triggering Guard Duty. We could spin up an ec2 in our own account to prevent Guard Duty from alerting, but thats not necessary for this walkthrough. If we install the aws cli and issue commands we run the risk of losing access to the box. The same issue presents itself if we use the Pacu proxy.\nWe’ll go ahead and run the risk of losing access, and install the aws cli on our instance.\nOnce its install we can validate that we have working credentials:\nsts get-caller-identity Perfect we have no pivoted from the kerrigan user to whatever permissions we have through the new mighty role. We should use our new abilities to see if we can determine the full extent of the mighty role.\naws iam list-attached-role-policies --role-name=cg-ec2-mighty-role-cgidawtm15fqxm and thankfully, it looks like we have some measure of IAM privileges because the output from that command shows us the policy associated with the role:\nPerhaps we have the ability to also see the configuration of that policy. Fist we’ll pull in some general information about the policy:\naws iam get-policy --policy-arn=arn:aws:iam:::policy/cg-ec2-mighty-policy Looking at the output above we are currently using policy version v1.\nWe can now get the configuration of the policy with:\naws iam get-policy-version --policy-arn=arn:aws:iam:::policy/cg-ec2-mighty-policy --version-id=v1 The output shows that we can take any action Action: * and we can access any resource Resource: *. Through this ec2 instance with the mighty role we are effectivly and administrator within this account. We can do anything that we would like.\n Prevention So, how do we prevent this. Where did the owner of this account go wrong? There are a few places where this could have be stopped. Lets dive into them.\n The first and probably the biggest is does the Kerrigan user need a static key? If they could be switched to temorary ephemeral keys it would greatly reduce the liklihood that if an attacker found the keys that they would still be valid. In this scenario specifically if we did not have the Kerrigan access key then this attack would have failed right out of gate. Does Kerrigan need this level of access? Looking at the policy:  { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Sid\": \"VisualEditor0\", \"Effect\": \"Allow\", \"Action\": [ \"iam:ListRoles\", \"iam:PassRole\", \"iam:ListInstanceProfiles\", \"iam:AddRoleToInstanceProfile\", \"iam:RemoveRoleFromInstanceProfile\", \"ec2:AssociateIamInstanceProfile\", \"ec2:DescribeIamInstanceProfileAssociations\", \"ec2:RunInstances\" ], \"Resource\": \"*\" }, { \"Sid\": \"VisualEditor1\", \"Effect\": \"Allow\", \"Action\": \"ec2:CreateKeyPair\", \"Resource\": \"*\" }, { \"Action\": [ \"ec2:DescribeInstances\",\"ec2:DescribeVpcs\", \"ec2:DescribeSubnets\", \"ec2:DescribeSecurityGroups\" ], \"Effect\": \"Allow\", \"Resource\": \"*\" } ] } This policy grants a lot of access, and a lot of it probably isnt necessary. The iam permissions could probably go away. But, perhaps they’re needed for an automation. What if the kerrigan keys are designed to spin up Ec2 instances, each has there own unique ssh key, and each need to have the same Instance profile associated with it so that it can access S3. If thats the case some of these permissions make sense. But we could still remove ListRoles, PassRole, ListInstanceProfiles, RemoveRoleFromInstanceProfile, DescribeiamInstanceProfileAssociations. These permissions were critical for us to be able to pivot from Kerrigan to an instance with mighty permissions.\nThe mighty role should probably just not exist at all. This would be an interesting discussion with the stakeholders to understand the purpose of this role. Perhaps there is a valid reason for it, but more than likely this could have permissions scoped in and not given full administrative rights to the account. Proper detections could also help. While they might not prevent the entire attack, they may help to slow everything down. If the Cloudtrail logs were baselined, and examined our activities would probably stick out. Our enumeration was very loud, we made hundereds of calls over a short period of time. Additionally we probably made calls that the Kerrigan never makes. This would allow a SOC to have a heads up of the malicious activity and begin investigating.  ","wordCount":"2210","inLanguage":"en","datePublished":"2018-11-28T00:00:00Z","dateModified":"2018-11-28T00:00:00Z","author":{"@type":"Person","name":"Travis"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jellyparks.com/posts/iam-privesc-by-attachment/"},"publisher":{"@type":"Organization","name":"JellyParks","logo":{"@type":"ImageObject","url":"https://jellyparks.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jellyparks.com accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://jellyparks.com/posts title=all_posts><span>all_posts</span></a></li><li><a href=https://jellyparks.com/categories/ title=categories><span>categories</span></a></li><li><a href=https://jellyparks.com/tags/ title=tags><span>tags</span></a></li><li><a href=https://jellyparks.com/me/ title=me><span>me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://jellyparks.com>Home</a>&nbsp;»&nbsp;<a href=https://jellyparks.com/posts/>Posts</a></div><h1 class=post-title>iam_privesc_by_attachment</h1><div class=post-meta><span title="2018-11-28 00:00:00 +0000 UTC">November 28, 2018</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;Travis&nbsp;|&nbsp;<a href=https://github.com/yogisec/yogisec.github.io/blob/main/content/posts/iam-privesc-by-attachment/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#whoami aria-label=whoami>whoami</a><ul><li><a href=#what-can-i-do aria-label="What can I do?">What can I do?</a></li><li><a href=#more-enumeration aria-label="More Enumeration">More Enumeration</a></li><li><a href=#make-an-ec2 aria-label="Make an ec2">Make an ec2</a></li><li><a href=#more-power aria-label="More Power">More Power</a></li><li><a href=#prevention aria-label=Prevention>Prevention</a></li></ul></li></ul></div></details></div><div class=post-content><hr><p>Once the scenario is creation process completes we are presented with a set of access keys for a user account &lsquo;kerrigan&rsquo;</p><p><img loading=lazy src=images/initial-user.png alt="Initial User" title=img-fluid></p><hr><h2 id=whoami>whoami<a hidden class=anchor aria-hidden=true href=#whoami>#</a></h2><p>First lets make sure the credentials that we have obtained are valid:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws sts get-caller-identity --profile xxx <span class=p>|</span>jq
</span></span></code></pre></div><p><img loading=lazy src=images/whoami.png alt=whoami title=img-fluid></p><p>Perfect, looks like the credentials work. Now, what can they do?</p><hr><h3 id=what-can-i-do>What can I do?<a hidden class=anchor aria-hidden=true href=#what-can-i-do>#</a></h3><p>Lets use pacu to brute force some permissions. We can do this by running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>run iam__bruteforce_permissions
</span></span></code></pre></div><p><img loading=lazy src=images/brute-force-perms.png alt=brute_force title=img-fluid></p><p>Once the command completes we see the output below:</p><p><img loading=lazy src=images/brute-force-output.png alt=brute_force_output title=img-fluid></p><p>Overall the credentials are fairly limited. But it does look like we have the ability to learn about ec2 instances with the describe command. Lets bounce back to the aws cli and run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws ec2 describe-instances <span class=p>|</span>jq
</span></span></code></pre></div><p>We get an output thatshows us details about the instances within the us-east region of this account. Lets clean this up a little bit just for fun.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws --profile kerrigan ec2 describe-instances <span class=p>|</span>jq -r <span class=s1>&#39;.Reservations[0].Instances[].InstanceId,.Reservations[0].Instances[].SecurityGroups[].GroupName,.Reservations[0].Instances[].NetworkInterfaces[].Association[]&#39;</span>
</span></span></code></pre></div><p>*<em>Note in the command above I set the Reservations to the value in the first index. To see all instances leave the brackets empty &lsquo;[]&rsquo;</em></p><p>This cleans up the verbose output and prints the instance id, security groups, and some networking details about the instance</p><p><img loading=lazy src=images/jq-fun.png alt=jq_fun title=img-fluid></p><p>Lets see what else our permissions can do. We&rsquo;ll start with the instance profiles command. According to Pacu we have rights to invoke this command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws iam list-instance-profiles <span class=p>|</span>jq
</span></span></code></pre></div><p>Looking at the output below we see a profile with the &lsquo;cg-ec2-meek-role&rsquo; associated with it.</p><p><img loading=lazy src=images/iam-list-profiles.png alt=iam_list_profiles title=img-fluid></p><p>Lets use pacu to see what instances,security groups, vpcs, and subnets exist within the environment:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>run ec2__enum --region<span class=o>=</span>us-east-1
</span></span></code></pre></div><p>Looking at the output we can see that there are currently 4 instances in the region as well as additional information that may become useful.</p><p><img loading=lazy src=images/ec2-enum.png alt=ec2_enum title=img-fluid></p><p>Within Pacu running the <code>data</code> command will dump all of the data from the current session. This will include all of the details we just enumerated about the EC2&rsquo;s within the account.</p><p>Lets head back to the aws cli and run the ec2 describe call again. This time instead of jq we will just print the output to a table.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws --profile kerrigan ec2 describe-instances --output table
</span></span></code></pre></div><p>Looking at the output we can see that there is an ec2 and one of the <code>tags</code> is that it is a <code>super critical server</code>.</p><p><img loading=lazy src=images/super-critical-tag.png alt=critical_ec2_enum title=img-fluid></p><hr><h3 id=more-enumeration>More Enumeration<a hidden class=anchor aria-hidden=true href=#more-enumeration>#</a></h3><p>Considering everything that we&rsquo;ve seen up to this point:</p><ul><li>A critical instance exists</li><li>We can perform several ec2 tasks</li><li>We do have some limited iam rights</li></ul><p>There seems to be some potential for us to create an instance. Lets use Pacu to see if we have any additional iam permissions that could be of use.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>run iam__enum_users_roles_policies_groups
</span></span></code></pre></div><p>In the output below it looks like we do not have permissions to make the: <code>list_users, list_groups, or list_policies calls</code>. We do however have permissions to list roles within the account.</p><p><img loading=lazy src=images/iam-permission-failure.png alt=iam_enum title=img-fluid></p><p>Lets dig into those a big more. This can be done by either running the <code>data</code> command from within Pacu or by running the following command via the aws cli:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws --profile kerrigan iam list-roles <span class=p>|</span> jq <span class=s1>&#39;.Roles[].RoleName&#39;</span>
</span></span></code></pre></div><p><img loading=lazy src=images/account-iam-roles.png alt=iam_roles title=img-fluid></p><p>Considering the role we saw associated with the ec2 instance earlier was called <code>meek</code> it&rsquo;s interesting to see another role with the name of <code>mightly</code>. Lets dig into that a bit more. Instead of making another <code>iam list-role</code>s call to AWS, lets just use the existing <code>data</code> within Pacu by running the data command.</p><p><img loading=lazy src=images/mighty-role.png alt=mighty_role title=img-fluid></p><p>In the picture above we can see that the <code>mighty</code> role is a role associated with the ec2 service. This is a role that can be associated with an ec2 profile, and the profile can be associated with an ec2 instance.</p><p>Considering we have permissions into describing instalnce profile associates, perhaps we also have the ability to associate different roles to a profile. Lets see if we can attach the mighty role to the ec2 profile</p><p>Only one role can be associated with an ec2 instance profile at a time. To begin we will see if we can remove the existing meek role from the profile. We need to pieces of information in order to remove a role from an instance profile. The role name we want to remove, and the profile we want to remove it from. Luckily we know both of those bits of information from our enumeration.</p><ul><li>Role: cg-ec2-meek-role-cgidawtm15fqxm</li><li>Profile: cg-ec2-meek-instance-profile-cgidawtm15fqxm</li></ul><pre tabindex=0><code>aws --profile kerrigan iam remove-role-from-instance-profile --instance-profile-name=cg-ec2-meek-instance-profile-cgidawtm15fqxm --role-name=cg-ec2-meek-role-cgidawtm15fqxm
</code></pre><p>If the command is successful, there will be no output, if it fails, it squawks. We can confirm it as successful by running the list-instance-profiles command again.</p><p><img loading=lazy src=images/instance-profile-no-role.png alt=no_role title=img-fluid></p><p>In the output above we see the <code>meek</code> instance profile with no roles associated with it. Great! Now lets try associating the <code>mighty</code> role with the <code>meek</code> instance profile. In order to do this we need two pieces of information, the role name, and the instance profile name.</p><ul><li>Role: cg-ec2-mighty-role-cgidawtm15fqxm</li><li>Profile: cg-ec2-meek-instance-profile-cgidawtm15fqxm</li></ul><pre tabindex=0><code>aws --profile kerrigan iam add-role-to-instance-profile --instance-profile-name=cg-ec2-meek-instance-profile-cgidawtm15fqxm --role-name=cg-ec2-mighty-role-cgidawtm15fqxm
</code></pre><p>Similar to the output when we removed the role from the profile, there will be no output if successful. However running the <code>list-instance-profiles</code> command again we can see that the <code>mighty</code> role has been associated with the <code>meek</code> instance profile.</p><p><img loading=lazy src=images/meek-profile-mighty-role.png alt=no_role title=img-fluid></p><p>Perfect! We now have the mighty role associated with the meek profile.</p><hr><h3 id=make-an-ec2>Make an ec2<a hidden class=anchor aria-hidden=true href=#make-an-ec2>#</a></h3><p>Lets create our own ec2 and see if we can associate the meek instance profile with the now might role attached to an ec2 instance that we can gain access to. In order to create an ec2 we need several pieces of information:</p><ul><li>ssh key</li><li>security group ids</li><li>subnet id</li><li>image-id</li><li>instance-type</li></ul><p>First we need a key pair the command below will create the ssh key named <code>totes-legit</code>, parses it with jq to just show the key details, and then sends the output into a file called totes-legit:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws --profile kerrigan ec2 create-key-pair --key-name totes-legit <span class=p>|</span>jq -r <span class=s1>&#39;.KeyMaterial&#39;</span> &gt; ~/.ssh/totes-legit
</span></span></code></pre></div><p>Next we need to find a security group that fits our needs, or see if we can build our own. After all what use is an instane if we cannot connect to it. We can use data from Pacu or we can make another call to aws</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws --profile kerrigan ec2 describe-security-groups
</span></span></code></pre></div><p>Looking at the output we can see that there is already a group that fits our needs, it allows SSH from an IP address that we have access to.</p><p><img loading=lazy src=images/ssh-security-group.png alt=security_group title=img-fluid></p><p>We know that the super critical server has a public IP address, we also have the subnet for that instance. We can use that subnet-id when we create our new instance.</p><p><img loading=lazy src=images/ec2-subnet.png alt=ec2_subnet title=img-fluid></p><p>At this point We have all of the pieces that we need to create an instance that we will have access to (hopefully).</p><ul><li>ssh key: totes-legit</li><li>security group ids: sg-0594794cf09e47456</li><li>subnet id: subnet-0157cfe78e8beca7a</li><li>image-id: ami-0a313d6098716f372</li><li>instance-type: t2.micro</li><li>Time to create an instance:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws --profile kerrigan ec2 run-instances --image-id<span class=o>=</span>ami-0a313d6098716f372 --count<span class=o>=</span><span class=m>1</span> --instance-type<span class=o>=</span>t2.micro --security-group-ids<span class=o>=</span>subnet-01a29bf90aca8c8d9 --subnet-id<span class=o>=</span>subnet-0157cfe78e8beca7a --key-name<span class=o>=</span>totes-legit --tags <span class=nv>Key</span><span class=o>=</span>Name,Value<span class=o>=</span>totes-legit
</span></span></code></pre></div><p>When this is successful all of the data bout our instance is returned. This includes our instance id, ip information, and current state. and returns our instance id.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=s2>&#34;InstanceId&#34;</span>: <span class=s2>&#34;i-06f3f5f9f8cdc9c6e&#34;</span>
</span></span></code></pre></div><p><img loading=lazy src=images/instance-provisioning.png alt=ec2_provision title=img-fluid></p><p>Unfortunatly, we don&rsquo;t seem to have a public IP address for our instance. Did something go wrong? Nope, the current stat of the instance was &lsquo;pending&rsquo;. We need to check back in on the instance an wait for the state to change to &lsquo;running&rsquo;. Once its running, we should also have public IP address information. We can do this with the <code>describe-instances</code> command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws --profile kerrigan ec2 describe-instances --instance-id<span class=o>=</span>i-06f3f5f9f8cdc9c6e
</span></span></code></pre></div><p><img loading=lazy src=images/ec2-running.png alt=ec2_running title=img-fluid></p><p>The output from the command in the picture above shows that the instance is &lsquo;running&rsquo; and that we have a public IP.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=s2>&#34;PublicIpAddress&#34;</span>: <span class=s2>&#34;18.232.65.212&#34;</span>
</span></span></code></pre></div><p>Now we can ssh into the box using our totes-legit key:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh -i ~/.ssh/totes-legit ubuntu@18.232.65.212
</span></span></code></pre></div><p>Now we can query the meta data service and extract the instance keys, or we could run commands directly through this ec2. Lets grab the keys.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://169.254.169.254/latest/meta-data/iam/
</span></span></code></pre></div><p>Weird, looking at the output below we get a 404 error and no access keys. What could cause that?</p><p><img loading=lazy src=images/404-iam.png alt=404_iam title=img-fluid></p><hr><h3 id=more-power>More Power<a hidden class=anchor aria-hidden=true href=#more-power>#</a></h3><p>Looking back at what we&rsquo;ve done.</p><ul><li>We found an instance profile</li><li>We disassociated a role with the instance profile</li><li>We associated a new role with the instance profile</li><li>We created an ec2 instance that we have access to.</li></ul><p>Something we have not done yet, associate an instance profile with our instance. This profile is how our instance gains privileges. Remeber, an ec2 can have an instance profile associated with it. That profile can have 1 role associated with it, and that role can have policies attached to it.</p><p>Lets assign a profile to our instance. We&rsquo;ll need our <code>instance Id</code>, and the <code>meek-instance</code> profile name we discovered earlier.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws --profile kerrigan ec2 associate-iam-instance-profile --instance-id<span class=o>=</span>i-06f3f5f9f8cdc9c6e --iam-instance-profile <span class=nv>Name</span><span class=o>=</span>cg-ec2-meek-instance-profile-cgidawtm15fqxm
</span></span></code></pre></div><p>Once the command is executed we&rsquo;ll see an output similar to the one below with a state of <code>associating</code></p><p><img loading=lazy src=images/associate-profile.png alt=associate_profile title=img-fluid></p><p>After a minute or two we can check back in on our instsance and attempt to curl for credentials again:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://169.254.169.254/latest/meta-data/iam/
</span></span></code></pre></div><p>The output has changed, from a 404 error to the one below.</p><p><img loading=lazy src=images/curl-iam.png alt=curl_iam title=img-fluid></p><p>Digging deeper into the meta data we can find an AccessKey, SecretAcessKey, and a Token needed to access the aws api</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://169.254.169.254/latest/meta-data/iam/security-credentials/cg-ec2-mighty-role-cgidawtm15fqxm
</span></span></code></pre></div><p><img loading=lazy src=images/access-key.png alt=access_key title=img-fluid></p><p>We have a few options at this point:</p><ul><li>Take the access key information and run aws cli commands from our workstation</li><li>Install/use the aws cli on the instance we control to run commands</li><li>Use the pacu proxy</li></ul><p>Each of these has there own benefits and draw backs. If we steal the keys and use them locally, we run the risk of triggering Guard Duty. We could spin up an ec2 in our own account to prevent Guard Duty from alerting, but thats not necessary for this walkthrough. If we install the aws cli and issue commands we run the risk of losing access to the box. The same issue presents itself if we use the Pacu proxy.</p><p>We&rsquo;ll go ahead and run the risk of losing access, and install the aws cli on our instance.</p><p>Once its install we can validate that we have working credentials:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sts get-caller-identity
</span></span></code></pre></div><p><img loading=lazy src=images/ec2-whoami.png alt=ec2_whoami title=img-fluid></p><p>Perfect we have no pivoted from the <code>kerrigan</code> user to whatever permissions we have through the new mighty role. We should use our new abilities to see if we can determine the full extent of the <code>mighty</code> role.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws iam list-attached-role-policies --role-name<span class=o>=</span>cg-ec2-mighty-role-cgidawtm15fqxm
</span></span></code></pre></div><p>and thankfully, it looks like we have some measure of IAM privileges because the output from that command shows us the policy associated with the role:</p><p><img loading=lazy src=images/mighty-policies.png alt=mighty_polices title=img-fluid>
Perhaps we have the ability to also see the configuration of that policy. Fist we&rsquo;ll pull in some general information about the policy:</p><pre tabindex=0><code>aws iam get-policy --policy-arn=arn:aws:iam:::policy/cg-ec2-mighty-policy
</code></pre><p><img loading=lazy src=images/policy-version.png alt=policy_version title=img-fluid></p><p>Looking at the output above we are currently using policy version v1.</p><p>We can now get the configuration of the policy with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws iam get-policy-version --policy-arn<span class=o>=</span>arn:aws:iam:::policy/cg-ec2-mighty-policy --version-id<span class=o>=</span>v1
</span></span></code></pre></div><p><img loading=lazy src=images/policy.png alt=policy title=img-fluid></p><p>The output shows that we can take any action Action: * and we can access any resource Resource: *. Through this ec2 instance with the mighty role we are effectivly and administrator within this account. We can do anything that we would like.</p><hr><h3 id=prevention>Prevention<a hidden class=anchor aria-hidden=true href=#prevention>#</a></h3><p>So, how do we prevent this. Where did the owner of this account go wrong? There are a few places where this could have be stopped. Lets dive into them.</p><ol><li>The first and probably the biggest is does the Kerrigan user need a static key? If they could be switched to temorary ephemeral keys it would greatly reduce the liklihood that if an attacker found the keys that they would still be valid. In this scenario specifically if we did not have the Kerrigan access key then this attack would have failed right out of gate.</li><li>Does Kerrigan need this level of access? Looking at the policy:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=nt>&#34;Version&#34;</span><span class=p>:</span> <span class=s2>&#34;2012-10-17&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=nt>&#34;Statement&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nt>&#34;Sid&#34;</span><span class=p>:</span> <span class=s2>&#34;VisualEditor0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;iam:ListRoles&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;iam:PassRole&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;iam:ListInstanceProfiles&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;iam:AddRoleToInstanceProfile&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;iam:RemoveRoleFromInstanceProfile&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ec2:AssociateIamInstanceProfile&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ec2:DescribeIamInstanceProfileAssociations&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ec2:RunInstances&#34;</span>
</span></span><span class=line><span class=cl>   <span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nt>&#34;Sid&#34;</span><span class=p>:</span> <span class=s2>&#34;VisualEditor1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=s2>&#34;ec2:CreateKeyPair&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ec2:DescribeInstances&#34;</span><span class=p>,</span><span class=s2>&#34;ec2:DescribeVpcs&#34;</span><span class=p>,</span> <span class=s2>&#34;ec2:DescribeSubnets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ec2:DescribeSecurityGroups&#34;</span>
</span></span><span class=line><span class=cl>   <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This policy grants a lot of access, and a lot of it probably isnt necessary. The iam permissions could probably go away. But, perhaps they&rsquo;re needed for an automation. What if the kerrigan keys are designed to spin up Ec2 instances, each has there own unique ssh key, and each need to have the same Instance profile associated with it so that it can access S3. If thats the case some of these permissions make sense. But we could still remove <code>ListRoles, PassRole, ListInstanceProfiles, RemoveRoleFromInstanceProfile, DescribeiamInstanceProfileAssociations</code>. These permissions were critical for us to be able to pivot from Kerrigan to an instance with mighty permissions.</p><ol start=3><li>The mighty role should probably just not exist at all. This would be an interesting discussion with the stakeholders to understand the purpose of this role. Perhaps there is a valid reason for it, but more than likely this could have permissions scoped in and not given full administrative rights to the account.</li><li>Proper detections could also help. While they might not prevent the entire attack, they may help to slow everything down. If the Cloudtrail logs were baselined, and examined our activities would probably stick out. Our enumeration was very loud, we made hundereds of calls over a short period of time. Additionally we probably made calls that the Kerrigan never makes. This would allow a SOC to have a heads up of the malicious activity and begin investigating.</li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://jellyparks.com/tags/aws/>aws</a></li><li><a href=https://jellyparks.com/tags/cloud/>cloud</a></li><li><a href=https://jellyparks.com/tags/cloudgoat/>cloudgoat</a></li><li><a href=https://jellyparks.com/tags/walkthrough/>walkthrough</a></li><li><a href=https://jellyparks.com/tags/ctf/>ctf</a></li></ul><nav class=paginav><a class=prev href=https://jellyparks.com/posts/emr-security-woes/><span class=title>« Prev Page</span><br><span>emr_security_woes</span></a>
<a class=next href=https://jellyparks.com/posts/iam-privesc-by-rollback/><span class=title>Next Page »</span><br><span>iam_privesc_by_rollback</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share iam_privesc_by_attachment on twitter" href="https://twitter.com/intent/tweet/?text=iam_privesc_by_attachment&url=https%3a%2f%2fjellyparks.com%2fposts%2fiam-privesc-by-attachment%2f&hashtags=aws%2ccloud%2ccloudgoat%2cwalkthrough%2cctf"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share iam_privesc_by_attachment on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fjellyparks.com%2fposts%2fiam-privesc-by-attachment%2f&title=iam_privesc_by_attachment&summary=iam_privesc_by_attachment&source=https%3a%2f%2fjellyparks.com%2fposts%2fiam-privesc-by-attachment%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share iam_privesc_by_attachment on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fjellyparks.com%2fposts%2fiam-privesc-by-attachment%2f&title=iam_privesc_by_attachment"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share iam_privesc_by_attachment on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjellyparks.com%2fposts%2fiam-privesc-by-attachment%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share iam_privesc_by_attachment on whatsapp" href="https://api.whatsapp.com/send?text=iam_privesc_by_attachment%20-%20https%3a%2f%2fjellyparks.com%2fposts%2fiam-privesc-by-attachment%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share iam_privesc_by_attachment on telegram" href="https://telegram.me/share/url?text=iam_privesc_by_attachment&url=https%3a%2f%2fjellyparks.com%2fposts%2fiam-privesc-by-attachment%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://jellyparks.com>JellyParks</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>